<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/modaal@0.4.4/dist/js/modaal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modaal@0.4.4/dist/css/modaal.min.css">

<link rel="stylesheet" href="style.css">

<style>

.tile{
  vertical-align: middle;
}

.modaal-container{
  max-width: 100%;
}

.modaal-inner-wrapper {
  display: table-cell;
  width: 100%;
  height: 100%;
  position: relative;
  vertical-align: middle;
  text-align: center;
  padding: 25px 25px;
}

.modaal-gallery-item img {
  display: block;
  max-height: calc(100vh - 60px);
}

</style>

</head>


<body>

<header>
  <div style="display: flex;margin-right: auto;">
    <a class="item" href=./index.html>home</a>
    /
    <a class="item" id='folder' href='_'>folder</a>
  </div>

  <div style="margin: auto; padding: 0px 40px;">
    <span id='title'></span>
  </div>

  <div style="margin-right: 20px; margin-left: auto;">
    <input type="range" id="cols" min="1" max="7" step="1">
  </div>
</header>

<center><span id='media'></span></center>


<script src="index.js"></script>
<script>
const contentId = location.search.split("?")[1];
const dir = `../contents/${contentId}`
const media_table = table[contentId]['media'];

document.title = `Album ${table[contentId]['title']}`

document.getElementById('folder').setAttribute('href', dir);
document.getElementById('title').innerHTML = `<a href='https://girls2-fc.jp/page/${table[contentId]['board']}/${contentId}'>${table[contentId]['title']}</a>`;

const media = document.getElementById('media');
function draw(r){
  media.innerHTML = media_table.map(function(e){
    const src = `${dir}/${e}`;
    const ext = src.slice(src.lastIndexOf('.'));
    const size = (window.innerWidth-100)/r;

    if([".jpeg", ".png"].indexOf(ext) > -1){
      return `<a class="image tile" data-group="gallery" href=${src}>`
        + `<img src="${src}" width=${size}></img>`
        + `</a>`;
    }
    else if([".mp4", '.mov'].indexOf(ext) > -1){
      return `<a class="iframe tile" href=${src}>`
        + `<video controls autoplay muted loop src="${src}" width=${size}></video>`
        + `</a>`;
    }
    else if([".mov"].indexOf(ext) > -1){
      return `<video controls autoplay muted loop src="${src}" class="tile" width=${size}></video>`;
    }
  }).join('');

  $('.image').modaal({
    type: 'image',
    hide_close: true,
  })
  $('.iframe').modaal({
    type: 'iframe',
    hide_close: true,
  });
}

window.onload = ()=>{
  const cols = document.getElementById('cols');
  cols.value = Math.min(Math.sqrt(media_table.length) * (window.innerWidth/window.innerHeight), media_table.length);
  cols.addEventListener('input', (e)=>{draw(e.target.value);});
  draw(cols.value);
}
</script>

</body>